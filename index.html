<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>ì½”ì£¼ë¶€ ê²°ì œì ëª…ë‹¨ ê²€ìƒ‰ (Apps Script JSON)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    table { border-collapse: collapse; font-size: 12px; }
    th, td { border:1px solid #e5e7eb; padding:4px 6px; white-space:nowrap; }
    th { background:#f1f5f9; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <div class="max-w-6xl mx-auto p-4 space-y-4">

    <header class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
      <div>
        <h1 class="text-lg font-bold">ì½”ì£¼ë¶€ ê²°ì œì ëª…ë‹¨ ê²€ìƒ‰</h1>
        <p class="text-xs text-slate-500 mt-1">
          Apps Script í”„ë¡ì‹œ(JSON)ë¥¼ í†µí•´ toss-customers ë°ì´í„°ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.
        </p>
      </div>
      <div class="flex flex-wrap items-center gap-2">
        <button id="btnFetch"
          class="px-3 py-2 text-sm rounded-lg bg-blue-600 text-white hover:bg-blue-700">
          ê²°ì œì ëª…ë‹¨ ë¶ˆëŸ¬ì˜¤ê¸°
        </button>
        <span id="status" class="text-xs text-slate-600"></span>
      </div>
    </header>

    <!-- ê²€ìƒ‰ / ì •ë³´ -->
    <section class="bg-white border border-slate-200 rounded-xl p-3 flex flex-wrap gap-3 items-center">
      <div class="flex-1 min-w-[180px]">
        <label class="block text-xs text-slate-500 mb-1">
          ê²€ìƒ‰ì–´ (ì´ë¦„, ì—°ë½ì²˜, ê°•ì˜ëª… ë“± ì „ì²´ì—´ ê²€ìƒ‰)
        </label>
        <input id="searchInput" type="text"
               class="w-full border border-slate-200 rounded-md px-3 py-1.5 text-sm"
               placeholder="ì˜ˆ: í™ê¸¸ë™, 010-1234, ê°•ì˜ëª… ì¼ë¶€ ë“±" />
      </div>
      <div class="flex items-center gap-2 text-xs text-slate-500">
        <span id="countInfo">ë°ì´í„° 0í–‰</span>
        <button id="btnClearSearch"
                class="px-2 py-1 border border-slate-300 rounded-md text-xs bg-slate-50 hover:bg-slate-100">
          ê²€ìƒ‰ ì´ˆê¸°í™”
        </button>
      </div>
    </section>

    <!-- ê²°ê³¼ í…Œì´ë¸” -->
    <section class="bg-white border border-slate-200 rounded-xl p-3">
      <div class="mb-2 text-xs text-slate-500 flex justify-between items-center">
        <span>ê²°ì œì ë¦¬ìŠ¤íŠ¸</span>
        <span id="pageInfo"></span>
      </div>
      <div class="overflow-auto max-h-[520px]">
        <table id="resultTable" class="w-full"></table>
      </div>
    </section>

  </div>

  <script>
    // ğŸ”´ ì—¬ê¸°ë§Œ ë„¤ Apps Script exec URLë¡œ ë°”ê¾¸ë©´ ë¨
    // ì˜ˆ) "https://script.google.com/macros/s/AKfycbyxy7MyOhgeO1IoVhgqAI6-j4-Vks52a2i28xodKSXA2Bws0_AcQKZDzAjJsS3WvoF-Ww/exec"
    const PROXY_URL = "https://script.google.com/macros/s/ì—¬ê¸°-ì›¹ì•±-ID/exec";

    const $  = (q) => document.querySelector(q);

    let header = [];
    let rows   = [];
    let lastTotal = 0;

    function setStatus(msg) {
      $("#status").textContent = msg || "";
    }

    function updateCountInfo() {
      if (!rows.length) {
        $("#countInfo").textContent = "ë°ì´í„° 0í–‰";
        return;
      }
      const shown = rows.length;
      const total = lastTotal || shown;
      $("#countInfo").textContent =
        `ì´ ${total}í–‰ ì¤‘ ${shown}í–‰ í‘œì‹œ (ìµœëŒ€ ${shown}í–‰ ë¶ˆëŸ¬ì˜´)`;
    }

    function renderTable() {
      const table = $("#resultTable");
      table.innerHTML = "";
      if (!header.length) return;

      const thead = document.createElement("thead");
      const trHead = document.createElement("tr");
      header.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h || "";
        trHead.appendChild(th);
      });
      thead.appendChild(trHead);

      const tbody = document.createElement("tbody");
      rows.forEach(row => {
        const tr = document.createElement("tr");
        header.forEach((_, idx) => {
          const td = document.createElement("td");
          td.textContent = (row[idx] ?? "").toString();
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });

      table.appendChild(thead);
      table.appendChild(tbody);

      $("#pageInfo").textContent = rows.length ? `${rows.length} rows` : "";
    }

    async function searchCustomers() {
      try {
        const q = $("#searchInput").value.trim();
        setStatus("ê²€ìƒ‰ ì¤‘...");
        $("#resultTable").innerHTML = "";
        $("#pageInfo").textContent = "";
        $("#countInfo").textContent = "ë°ì´í„° 0í–‰";

        const url = PROXY_URL + "?q=" + encodeURIComponent(q);
        const res = await fetch(url);
        if (!res.ok) throw new Error("HTTP " + res.status);

        // Apps Script ì—ì„œ {header, rows, total} êµ¬ì¡°ë¡œ ë³´ë‚´ê³  ìˆìŒ
        const data = await res.json();
        console.log("ì‘ë‹µ JSON:", data);   // ë””ë²„ê¹…ìš©

        header = data.header || [];
        rows   = data.rows   || [];
        lastTotal = data.total || rows.length;

        updateCountInfo();
        renderTable();

        setStatus("ê²€ìƒ‰ ì™„ë£Œ");
      } catch (err) {
        console.error("searchCustomers error:", err);
        setStatus("í˜¸ì¶œ ì‹¤íŒ¨: " + (err.message || err));
        alert("ê²°ì œì ëª…ë‹¨ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨\n" + (err.message || err));
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      $("#btnFetch").addEventListener("click", (e) => {
        e.preventDefault();
        searchCustomers();
      });

      $("#searchInput").addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          searchCustomers();
        }
      });

      $("#btnClearSearch").addEventListener("click", (e) => {
        e.preventDefault();
        $("#searchInput").value = "";
        searchCustomers();   // ë¹ˆ ê²€ìƒ‰ì–´ë¡œ ì „ì²´(ì•ë¶€ë¶„) ì¡°íšŒ
      });
    });
  </script>
</body>
</html>
